<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HCPrediksi ‚Äì Pra-Studi</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
html,body{margin:0;height:100%;background:#000;font-family:Arial}
#map{width:100%;height:100%}

#header{
 position:absolute;top:10px;left:50%;transform:translateX(-50%);
 background:rgba(0,0,0,.75);
 padding:8px 18px;border-radius:16px;
 z-index:999;text-align:center
}
#header h1{margin:0;color:#4de3ff;font-size:16px}
#header p{margin:0;font-size:10px;color:#bbb}

#info{
 position:absolute;top:70px;left:10px;
 background:rgba(10,15,25,.8);
 padding:10px;border-radius:14px;
 font-size:11px;color:#fff;z-index:999
}
#info b{color:#4de3ff}

#studyPanel{
 position:absolute;top:70px;right:10px;
 width:200px;max-height:260px;
 overflow:auto;
 background:rgba(10,15,25,.9);
 padding:10px;border-radius:14px;
 font-size:10px;color:#fff;z-index:999
}

#footer{
 position:absolute;bottom:12px;left:50%;transform:translateX(-50%);
 background:rgba(0,0,0,.65);
 padding:6px 12px;border-radius:12px;
 font-size:9px;color:#ccc;z-index:999;text-align:center
}

button{
 width:100%;margin-top:6px;padding:6px;
 background:#111;color:#fff;
 border-radius:10px;border:1px solid rgba(255,255,255,.2);
 font-size:11px
}
</style>
</head>

<body>

<div id="header">
 <h1>HCPrediksi</h1>
 <p>Pra-Studi Visual Lokasi ( Preview)</p>
</div>

<div id="info">
 üì° <b>GPS Aktif</b><br>
 üîç Mode: Alternatif Titik Kajian<br>
 üìä Output: Visual & Ranking
 <button onclick="exportMap()">Export Peta </button>
</div>

<div id="studyPanel">
 <b>Alternatif Titik Kajian</b><br><br>
 Klik peta untuk menambah titik
</div>

<div id="footer">
‚ö†Ô∏è Aplikasi ini hanya visual pra-studi.<br>
Bukan data geologi, geofisika, atau rekomendasi pengeboran.
</div>

<div id="map"></div>

<script>
const map = L.map('map');

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
 maxZoom:19
}).addTo(map);

let studyPoints = [];
let counter = 1;

// ======= ENGINE PRA-STUDI =======
function generateScore(){
 return Math.floor(45 + Math.random()*45); // 45‚Äì90 (aman)
}

function studyStatus(score){
 if(score >= 75) return 'Kajian Lanjutan';
 if(score >= 60) return 'Perlu Survei Awal';
 return 'Desktop Study';
}

function pointColor(score){
 if(score >= 75) return '#facc15';
 if(score >= 60) return '#38bdf8';
 return '#9ca3af';
}

// ======= RENDER PANEL =======
function updatePanel(){
 const p = document.getElementById('studyPanel');
 p.innerHTML = '<b>Alternatif Titik Kajian</b><br><br>';

 studyPoints
 .sort((a,b)=>b.score-a.score)
 .forEach(s=>{
   p.innerHTML += `
    <b>${s.id}</b> | Index: <b>${s.score}</b><br>
    ${s.status}<br>
    <span style="opacity:.6">${s.lat.toFixed(5)}, ${s.lon.toFixed(5)}</span><br><br>
   `;
 });
}

// ======= GPS =======
navigator.geolocation.getCurrentPosition(pos=>{
 const lat = pos.coords.latitude;
 const lon = pos.coords.longitude;

 map.setView([lat,lon],14);

 L.circle([lat,lon],{
  radius:2000,
  color:'#4de3ff',
  fillColor:'#4de3ff',
  fillOpacity:.05
 }).addTo(map);

});

// ======= KLIK TAMBAH TITIK =======
map.on('click',(e)=>{
 const score = generateScore();
 const status = studyStatus(score);

 const point = {
  id:'SP-'+counter++,
  lat:e.latlng.lat,
  lon:e.latlng.lng,
  score:score,
  status:status
 };

 studyPoints.push(point);

 const marker = L.circleMarker([point.lat,point.lon],{
  radius:6,
  color:pointColor(score),
  fillColor:pointColor(score),
  fillOpacity:1
 }).addTo(map);

 marker.bindPopup(`
  <b>${point.id}</b><br>
  Index Studi: <b>${score}</b><br>
  Status: ${status}<br><br>
  Tahapan:<br>
  ‚Ä¢ Desktop Study<br>
  ‚Ä¢ Survei Geologi<br>
  ‚Ä¢ Survei Seismik
 `);

 updatePanel();
});

// ======= EXPORT =======
function exportMap(){
 html2canvas(document.body).then(canvas=>{
  const a = document.createElement('a');
  a.download='HCPrediksi_PraStudi_Investor.png';
  a.href=canvas.toDataURL();
  a.click();
 });
}
</script>

</body>
</html>